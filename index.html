<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Magalu Cons√≥rcio √ó MAPFRE ‚Äî Seguro do Saldo Devedor</title>
  <meta name="description" content="Proteja o saldo devedor do seu Cons√≥rcio Magalu com o seguro MAPFRE (Morte e IPTA). Jornada 100% digital.">
  <meta name="theme-color" content="#0b1220">
  <style>
    :root{
      --bg:#e9e9e9;         /* fundo geral */ 
      --ink:#e9edff;        /* texto prim√°rio */
      --muted:#d3d3d3;      /* texto secund√°rio */
      --line:#0052f5;       /* linhas */
      --line2:#cfc7c7;       /* linhas */
      --line3:#f7ae61;       /* linhas */
      --card:#0087ff;       /* cards escuros */
      --card2:#ff8a0f;       /* cards laranjas */
      --card3:#ffffff;       /* cards branco */
      --brand:#ff8a0f;      /* azul destaque */      
      --brand-2:#39B2FF;    /* azul claro  0087ff */
      --brand-3:#0c48bf;    /* azul profundo */
      --accent:#1fff17;     /* link WA */
      --danger:#D81E05;     /* MAPFRE/erro */
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,"Noto Sans",sans-serif}
    a{color:var(--brand)}
    header{padding:14px 16px;background:var(--bg);position:sticky;top:0;z-index:20}
    header .wrap{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between}
    header img{display:block;height:40px;width:auto}
    .brand-pill{margin:8px auto 0 auto;display:inline-block;background:#0e1a32;border:1px solid var(--line);border-radius:999px;padding:8px 14px;color:#9fb7ff;font-weight:800;font-size:12px;letter-spacing:.3px}
    main{max-width:1100px;margin:0 auto;padding:0 16px 40px}
    .hero{margin:10px 0 22px;border-radius:22px;overflow:hidden;background:linear-gradient(165deg,#335ead 0%,#0087ff 50%,#1a73ff 100%);box-shadow:0 8px 26px rgba(0,0,0,.15)}
    .hero .bd{padding:22px 24px 26px}
    .hero h1{margin:8px 0 10px;font-size:34px;line-height:1.15}
    .chips{display:flex;gap:10px;flex-wrap:wrap;margin:6px 0 10px}
    .chip{background:rgba(245, 245, 245, 0.14);border-radius:999px;padding:7px 14px;font-weight:800;font-size:12px}
    .chip.alt{background:#ffffff;color:#ff8a0f}
    .chip.alt2{background: #ff8a0f;;color:#ffffff}
    .hero .lead{color:#eaf2ff}
    .hero .from{color:#eaf2ff;font-weight:800}
    .cta{appearance:none;border:0;border-radius:12px;background:#fff;color:#ff8a0f;padding:14px 22px;font-weight:900;cursor:pointer;text-decoration:none;display:inline-block}
    .cta.secondary{background:var(--brand);color:#fff;box-shadow:0 10px 22px rgba(26,115,255,.35)}
    .cta:focus{outline:3px solid rgba(255,255,255,.35);outline-offset:2px}
    .cards{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin:16px 0}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius)}
    .card .bd{padding:14px}
    .card h3{margin:0 0 6px;font-size:16px}
    .card2{background:var(--card2);border:1px solid var(--line3);border-radius:var(--radius)}
    .card2 .bd{padding:14px}
    .card2 h3{margin:0 0 6px;font-size:16px}
    .card3{background:var(--card3);border:1px solid var(--line2);border-radius:var(--radius); color: #000000}
    .card3 .bd{padding:14px}
    .card3 h3{margin:0 0 6px;font-size:16px}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:18px;margin-top:18px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .panel{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);overflow:hidden}
    .panel .hd{padding:14px 16px;border-bottom:1px solid var(--line);font-weight:900}
    .panel .bd{padding:16px}
    .panel2 {background: white; border: 1px solid var(--line2);border-radius: var(--radius);overflow: hidden; color:#000000}    
    .panel2 .hd{padding:14px 16px;border-bottom:1px solid var(--line2);font-weight:700}
    .panel2 .bd{padding:16px}
    label{display:block;font-weight:800;margin:10px 0 6px}
    input,select{width:100%;padding:12px;border:1px solid var(--line);border-radius:10px;background:#ffffff}
    input::placeholder{color:#7c8bb7}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){.row{grid-template-columns:1fr}}
    .hint{font-size:12px;color:var(--muted)}
    .hint2{font-size:12px}
    .error{color:#ffffff;font-size:13px;margin-top:6px}
    .hide{display:none}
    footer{color:#000000;font-size:12px;margin:28px 0;text-align:center}
    .stepper{display:flex;gap:8px;align-items:center;font-size:12px;color:#9fb0d9;margin:6px 0 0}
    .dot{width:8px;height:8px;border-radius:50%;background:#405080}
    .dot.active{background:#7fa8ff}
    details summary{cursor:pointer;font-weight:900}
    .bold{font-weight: bold;}
    .grid-hero {display:grid;grid-template-columns:1fr 1fr;align-items:center;gap: 20px;}
    .hero-img img {width: 100%;max-width: 500px;display: block;margin: 0 auto;border-radius: var(--radius);}
    @media (max-width: 768px) {.grid-hero {grid-template-columns: 1fr;text-align: center;}.hero-img img {max-width: 70%;}
}



  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <img src="https://wkfkeepinsmarsh.blob.core.windows.net/arquivamento/html/img/documentos/1027/604/6049consorcio-removebg-preview.png?sp=r&st=2025-05-21T01:16:44Z&se=2026-05-21T09:16:44Z&spr=https&sv=2024-11-04&sr=c&sig=0o75S62Z761Xs2J5GX5XaVRwz%2BlqaGD3trx2uaKZzYw%3D
 " height="40" alt="Magalu Cons√≥rcio">
      <img src="https://wkfkeepinsmarsh.blob.core.windows.net/arquivamento/html/img/documentos/1027/604/6043Mapfre_logo.svg.png?sp=r&st=2025-05-21T01:16:44Z&se=2026-05-21T09:16:44Z&spr=https&sv=2024-11-04&sr=c&sig=0o75S62Z761Xs2J5GX5XaVRwz%2BlqaGD3trx2uaKZzYw%3D" height="40" alt="MAPFRE">
    </div>
  </header>

  <main>
   <section class="hero" aria-label="Oferta">
  <div class="bd grid-hero">
    
    <!-- Bloco de texto -->
    <div class="hero-text">
      <div class="hint" style="opacity:.9;font-weight:800;text-transform:uppercase;letter-spacing:.3px">Exclusivo para clientes Magalu Cons√≥rcio</div>
      <h1>Prote√ß√£o imediata do seu saldo devedor</h1>
      <div class="chips" id="chips">
        <span class="chip alt2" id="chipGrupoCota">
          Grupo <strong id="StrongGrupoVar">{{grupo}}</strong> ‚Ä¢ 
          <strong id="StrongCotaVar">Cota {{cota}}</strong>
        </span>
        <span class="chip alt2">Coberturas: Morte e IPTA</span>
        <span class="chip alt">100% digital</span>
      </div>
      <p class="lead">Indeniza√ß√£o aplicada ao <strong>saldo devedor</strong> do cons√≥rcio.</p>
      <p class="from">No valor de R$<span id="preco"><strong id="StrongPremio_mensalVar">{{premiomensal}}</strong></span>/m√™s*</p>
    </div>

    <!-- Bloco da imagem -->
    <div class="hero-img">
      <img src="https://wkfkeepinsmarsh.blob.core.windows.net/arquivamento/html/img/documentos/1027/604/6049Protecaofamiliar1.png?sp=r&st=2025-05-21T01:16:44Z&se=2026-05-21T09:16:44Z&spr=https&sv=2024-11-04&sr=c&sig=0o75S62Z761Xs2J5GX5XaVRwz%2BlqaGD3trx2uaKZzYw%3D" alt="Prote√ß√£o familiar">
    </div>

  </div>
</section>

    <section id="beneficios">
      <div class="cards">
        <article class="card3"><div class="bd"><h3>üõ°Ô∏è Saldo protegido</h3><div class="hint2">Indeniza√ß√£o aplicada ao saldo devedor.</div></div></article>
        <article class="card3"><div class="bd"><h3>‚ö° 100% digital</h3><div class="hint2">Contrata√ß√£o r√°pida, sem burocracia.</div></div></article>
      </div>
    </section>

    <section class="grid">
      <div>
        <article class="panel" id="step-cpf">
          <div class="hd">1) Comece informando os 3 primeiro digitos do seu CPF <div class="stepper"><span class="dot active"></span><span class="dot"></span><span class="dot"></span></div></div>
          <div class="bd">
            <div class="row">
              <div>
                <label for="cpf">CPF</label>
                <input id="cpf" name="cpf" inputmode="numeric" autocomplete="off" placeholder="Digite os 3 primeiros n√∫meros do CPF" aria-describedby="cpfHint cpfError">
                <div id="cpfHint" class="hint">Usaremos para localizar seus dados no Magalu. N√£o armazenamos sem o seu consentimento.</div>
                <div id="cpfError" class="error hide bold" role="alert" style="color: #ffffff">CPF INV√ÅlIDO. VERIFIQUE E TENTE NOVAMENTE.</div>
              </div>
              <div style="display:flex;align-items:flex-end;gap:12px">
                <button id="btnCpf" class="cta secondary">Validar CPF</button>
                <button id="btnLimpar" class="cta" type="button">Limpar</button>
              </div>
            </div>
          </div>
        </article>

        <form class="panel hide" id="form-adesao" method="post" action="#">
          <!-- <div class="hd">2) Dados do participante -->
          <div class="hd">2) Confirme se seus dados est√£o corretos.
            <div class="hint">Se algum valor estiver incorreto, √© poss√≠vel alter√°-lo</div>
          </div>
          
          <div class="bd">
            <div class="row">
              <div><label for="nome">Nome completo *</label><input id="nome" name="nome" required></div>
              <div><label for="nascimento">Data de nascimento *</label><input id="nascimento" name="nascimento" type="date" required><div class="hint">Usado para validar a elegibilidade de idade.</div></div>
            </div>
            <div class="row">
              <div><label for="rg">RG *</label><input id="rg" name="rg" required maxlength="9"></div>
              <div><label for="telefone">Telefone *</label><input id="telefone" name="telefone" inputmode="tel" required placeholder="(11) 99999-9999" maxlength="11"></div>
            </div>
            <div class="row">
            <div><label for="endereco">Endere√ßo *</label><input id="endereco" name="endereco" required></div>
            <div><label for="cep">CEP *</label><input id="cep" name="cep" required></div>
            </div>
            <div class="row">
            <div><label for="bairro">bairro *</label><input id="bairro" name="bairro" required></div>
            <div><label for="cidade">cidade *</label><input id="cidade" name="cidade" required></div>
            <div><label for="pep">Voc√™ √© PEP? *</label>
                <select id="pep" name="pep" required>
                  <option value="">Selecione‚Ä¶</option>
                  <option value="false">N√£o</option>
                  <option value="true">Sim</option>
                </select>
              </div>
            <!-- <div><label for="prazo">Prazo do grupo (meses)</label><input id="prazo" name="prazo" type="number" min="1" step="1" placeholder="Ex.: 60"></div> -->
            <div><label for="uf">uf *</label><input id="uf" name="uf" required></div>
            </div>
            <div class="row">
              <div><label for="profissao">Profiss√£o *</label><input id="profissao" name="profissao" required></div>
              <!-- <div><label for="renda">Faixa de renda *</label>
                <select id="renda" name="renda" required>
                  <option value="">Selecione‚Ä¶</option>
                  <option>At√© 2 SM</option>
                  <option>De 2 a 5 SM</option>
                  <option>De 5 a 10 SM</option>
                  <option>Acima de 10 SM</option>
                </select>
              </div> -->
              <div><label for="renda">Faixa de renda *</label><input id="renda" name="renda" required></div>
            </div>
            <div class="row">
              <div><label for="grupo">Grupo *</label><input id="grupo" name="grupo" required></div>
              <div><label for="cota">Cota *</label><input id="cota" name="cota" required></div>
            </div>
            <div class="row">
              <div><label for="venda">Voce confirma o interece de compra?</label>
              <select id="venda" name="venda" required>
                  <option value="">Selecione‚Ä¶</option>
                  <option value=false>N√£o</option>
                  <option value=true>Sim</option>
                </select></div>
            </div>
            <!-- <div class="row">
              <div><label for="pep">Voc√™ √© PEP? *</label>
                <select id="pep" name="pep" required>
                  <option value="">Selecione‚Ä¶</option>
                  <option value="false">N√£o</option>
                  <option value="true">Sim</option>
                </select>
              </div>
            </div> -->
            <div style="margin:12px 0 4px"><label><input type="checkbox" id="consent" required> Confirmo que li e aceito as Condi√ß√µes Gerais e autorizo o uso dos meus dados nos termos da LGPD.</label></div>
            <!-- <div class="hint">Condi√ß√µes Gerais do seguro (PDF): <a href="#" target="_blank" rel="noopener">baixar</a></div> -->
            <div id="eligError" class="error hide" role="alert"></div>
            <div style="display:flex;gap:12px;margin-top:14px;flex-wrap:wrap">
              <button class="cta secondary" id="btnOptIn" type="submit">Sim, quero contratar</button>
              <!-- <button class="cta" id="btnOptOut" type="button">N√£o desejo contratar</button> -->
            </div>
          </div>
          <input type="hidden" name="cpf_hidden" id="cpf_hidden">
          <!-- <input type="hidden" name="optin" id="optin" value="true">
          <input type="hidden" name="utm_source" id="utm_source">
          <input type="hidden" name="utm_medium" id="utm_medium">
          <input type="hidden" name="utm_campaign" id="utm_campaign"> -->
        </form>

        <article id="step-ok" class="panel hide" aria-live="polite">
          <div class="hd">3) Tudo certo ‚úÖ</div>
          <div class="bd" id="okMsg">Obrigado! Enviamos a confirma√ß√£o e pr√≥ximas etapas para seu e‚Äëmail.</div>
        </article>
      </div>

      <aside>
        <article class="panel2"><div class="hd">D√∫vidas frequentes</div>
          <div class="bd">
            <details open>
              <summary>O que √© a cobertura sobre o saldo devedor?</summary>
              <div class="hint2">Em caso de sinistro coberto, a indeniza√ß√£o √© aplicada sobre o saldo devedor do cons√≥rcio, conforme condi√ß√µes da ap√≥lice.</div>
            </details>
            <details>
              <summary>Posso contratar online?</summary>
              <div class="hint2">Sim. A jornada √© 100% digital e sujeita √† an√°lise e √†s Condi√ß√µes Gerais.</div>
            </details>
            <details>
              <summary>Quais idades s√£o eleg√≠veis?</summary>
              <div class="hint2">De 14 a 69 anos, e a soma (idade + prazo do grupo) n√£o pode exceder 78 anos.</div>
            </details>
            <div style="margin-top:14px" class="hint2">D√∫vidas? <a id="linkWhats" style="color:#0087ff">Fale no WhatsApp</a></div>
          </div>
        </article>
        <article class="panel2" style="margin-top:18px"><div class="hd">Importante</div>
          <div class="bd">
            <div class="hint2" style="color:#000000">                    Idade eleg√≠vel: de 14 a 69 anos.
                    *Valor estimado, sujeito √† an√°lise e √†s Condi√ß√µes Gerais da MAPFRE.</div>
          </div>
        </article>
      </aside>
    </section>

    <footer>¬© <span id="ano"></span> Magalu Cons√≥rcio ‚Äî Seguro MAPFRE.</footer>
  </main>

  <script>

    window.onload = function (){
      
      
      var params = new URLSearchParams(window.location.search)
      //var grupo = params.get("grupo")
      window.cpf1 = validarCPF(params.get("cpf1"))
      window.cpf2 = validarParametro(params.get("cpf1"))
      window.idsegurado = validarParametro(params.get("idsegurado"))
      const pepValor = validarParametro(params.get("pep"))
      pegarValorPeP(pepValor)      
     
      const cota = validarParametro(params.get("cota"))
      const taxa = validarParametro(params.get("taxa"))
      const valorcredito = validarParametro(params.get("valorcredito"))
      const whatsVar = validarParametro(params.get("whats"))
      const linkvarWhats = document.getElementById("linkWhats")
      const faixarenda = validarParametro(params.get("faixarenda"))
      pegarValorRenda(faixarenda)

      linkvarWhats.href = whatsVar
      linkvarWhats.target = "_blank" 
      
      //Transformando valores em numeros
      const taxaNumerica = parseFloat(taxa.replace(',', '.'));
      const valorCreditoNumerico = parseFloat(valorcredito);
      const premio_mensal = taxaNumerica * valorCreditoNumerico;
      window.valor_mes = premio_mensal 
      window.taxa = taxa
      window.valorcredito = valorcredito


      
      const premio_mensal_formatado = premio_mensal.toLocaleString('pt-BR', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
      });
      const grupo = validarParametro(params.get("grupo"))
      const StrongGrupoElemente = document.querySelector("#StrongGrupoVar")

      StrongGrupoElemente.textContent = grupo
      
      const StrongPremio_mensalElemente = document.querySelector("#StrongPremio_mensalVar")
      StrongPremio_mensalElemente.textContent = premio_mensal_formatado

      const StrongCotaElemente = document.querySelector("#StrongCotaVar")
      StrongCotaElemente.textContent = cota

      const dataDeNas = validarParametro(params.get("dataDeNas")) 
      console.log("log da data")
      console.log(dataDeNas)
      pegarDataCerta(dataDeNas)




      const cleanUrl = window.location.pathname + window.location.hash;
      window.history.replaceState(null, document.title, cleanUrl);
    }


    function pegarDataCerta(elemento) {
      try {
        const [dia, mes, ano] = elemento.split('-').map(Number);

        const data = new Date(ano, mes - 1, dia); 
 
        const anoFormatado = data.getFullYear();
        const mesFormatado = String(data.getMonth() + 1).padStart(2, '0');
        const diaFormatado = String(data.getDate()).padStart(2, '0');

        const dataFormatada = `${anoFormatado}-${mesFormatado}-${diaFormatado}`;

        console.log(dataFormatada);
        document.getElementById("nascimento").value = dataFormatada;
      } catch (error) {
        console.log("Ocorreu um erro na hora de pegar o valor da data de nascimento");
      }
    }

    // function tratarBooleano(elemento){
    //   if(elemento = "Sim"){
    //     return true
    //   }
    //   if(elemento = "N√£o"){
    //     return  false
    //   }
    // }
    
    function pegarValorRenda(elemento){
      // if(!isNaN(elemento)){
      //   if(elemento <= 3036 ) {         
      //     document.getElementById("renda").value = "At√© 2 SM"
      //   }
      //   else if(elemento >= 3037 && elemento <= 7590) {
      //   document.getElementById("renda").value = "De 2 a 5 SM"
      //   }
      //   else if(elemento >= 7590 && elemento <= 15180) {
      //   document.getElementById("renda").value = "De 5 a 10 SM"
      //   }
      //   if(elemento > 15180 ) {         
      //     document.getElementById("renda").value = "Acima de 10 SM"
      //   }

      // } else{
      //   console.log("o numero n√£o √© valido")

      // }
      document.getElementById("renda").value = elemento
    }


    function pegarValorPeP(elemento){
          try {
        const valor = elemento?.toLowerCase()
        if (valor === "sim") {
          document.getElementById("pep").value = "true";
        } else if (valor === "n√£o" || valor === "nao") {
          document.getElementById("pep").value = "false";
        } else {
          console.warn("Valor inesperado:", valor);
        }
      } catch (erro) {
        console.error("Erro ao atualizar o campo PEP:", erro);
      }
    }

    function validarParametro(elemento){
      if(elemento == null){
        elemento = "valor n√£o encontrado"
      }
      return elemento
    }
    function validarCPF(elemento){
      elemento = elemento.substring(0, 3);
      console.log(elemento)
    return elemento
    }

    // ===== Utilit√°rios =====
    const qs = new URLSearchParams(location.search);
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    const dataLayer = window.dataLayer = window.dataLayer || [];

    // Prefill de campos por querystring
    const prefillMap = {cpf:'#cpf', nome:'#nome', rg:'#rg', endereco:'#endereco', telefone:'#telefone', grupo:'#grupo', cota:'#cota', profissao:'#profissao', renda:'#renda', pep:'#pep', prazo:'#prazo', premio:'#preco', cep:'#cep', bairro: '#bairro', cidade:'#cidade', uf:'#uf', taxa: '#taxa', valorcredito: '#valorcredito' };
    
    Object.entries(prefillMap).forEach(([k,sel]) => { const val = qs.get(k); if(val && $(sel)) { if(sel==='#preco'){ $(sel).textContent = val; } else { $(sel).value = val; } } });
    
    // UTM tracking
    ['utm_source','utm_medium','utm_campaign'].forEach(k => { const v = qs.get(k); if(v) $('#'+k).value = v; });

    // Ano no rodap√©
    $('#ano').textContent = new Date().getFullYear();

    // M√°scara CPF
    $('#cpf').addEventListener('input', e => { let v = e.target.value.replace(/\D/g,'').slice(0,11); v = v.replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d{1,2})$/,'$1-$2'); e.target.value = v; });

    // Valida√ß√£o CPF
function validaCPF(cpf){ 
  return cpf === cpf1;
}

    function data() {
      // hor√°rio de Bras√≠lia
      let agora = new Date();
      let options = { timeZone: "America/Sao_Paulo" };
      let dataBrasilia = new Date(agora.toLocaleString("en-US", options));

      // soma +3 horas
      dataBrasilia.setHours(dataBrasilia.getHours() + 3);

      // pega ano e hora
      let ano = dataBrasilia.getFullYear();
      let hora = dataBrasilia.getHours().toString().padStart(2, "0");

      // resto da data (dia e m√™s)
      let dia = dataBrasilia.getDate().toString().padStart(2, "0");
      let mes = (dataBrasilia.getMonth() + 1).toString().padStart(2, "0");

      // monta resultado: ANO + dia/m√™s + HORA
      let resultado = `${ano}${dia}${mes}${hora}`;

      return resultado;
    }

    function getFormattedDate() {
  const d = new Date();
  const day = String(d.getDate()).padStart(2, '0');
  const month = String(d.getMonth() + 1).padStart(2, '0'); // meses come√ßam em 0
  const year = d.getFullYear();
  return `${day}/${month}/${year}`;
}

    // Idade (anos completos)
    function idade(nasc){ const d=new Date(nasc); if(isNaN(+d)) return null; const t=new Date(); let i=t.getFullYear()-d.getFullYear(); const m=t.getMonth()-d.getMonth(); if(m<0||(m===0&&t.getDate()<d.getDate())) i--; return i; }

    function show(el){ el.classList.remove('hide'); }
    function hide(el){ el.classList.add('hide'); }
    function stepActive(n){ const dots=$$('.stepper .dot'); dots.forEach((d,i)=> d.classList.toggle('active', i < n)); }

    // Fluxo: validar CPF ‚Üí buscar dados ‚Üí mostrar formul√°rio
    $('#btnCpf').addEventListener('click', async () => {
      let cpf = $('#cpf').value.trim();
      if(!validaCPF(cpf)) { $('#cpfError').classList.remove('hide'); return; }
      $('#cpfError').classList.add('hide');
      $('#cpf_hidden').value = cpf.replace(/\D/g,'');

      // Lookup opcional
      // try {
      //   // const r = await fetch(`/api/lookup?cpf=${encodeURIComponent($('#cpf_hidden').value)}`);
      //   if(r.ok){
      //     const j = await r.json();
      //     if(j.grupo) $('#grupo').value = j.grupo;
      //     if(j.cota) $('#cota').value = j.cota;
      //     if(j.prazo_meses) $('#prazo').value = j.prazo_meses;
      //     if(j.premio_mensal){ $('#preco').textContent = 'R$ ' + j.premio_mensal; }
      //     // Atualiza chip Grupo/Cota
      //     $('#chipGrupoCota').textContent = `Grupo ${j.grupo||'‚Äî'} ‚Ä¢ Cota ${j.cota||'‚Äî'}`;
      //   }
      // } catch(e) { /* segue sem prefill */ }

      hide($('#step-cpf'));
      show($('#form-adesao'));
      stepActive(2);
      dataLayer.push({event:'cpf_validado'});
    });

    $('#btnLimpar').addEventListener('click', ()=> { $('#cpf').value=''; $('#cpf').focus(); });

    // Envio Opt‚Äëin
    $('#form-adesao').addEventListener('submit', async (e) => {
      e.preventDefault();
      const nasc = $('#nascimento').value; const i = idade(nasc);
      // const prazo = parseInt($('#prazo').value || '0', 10);
      const prazo = 0
      const elegivel = i!=null && i>=14 && i<=69 && (i + (isFinite(prazo)?prazo/12:0)) <= 78;
      if(!elegivel){ const box=$('#eligError'); box.textContent = i==null ? 'Preencha sua data de nascimento.' : 'Voc√™ n√£o atende aos crit√©rios de elegibilidade (idade e/ou prazo).'; box.classList.remove('hide'); box.scrollIntoView({behavior:'smooth',block:'center'}); return; }
      if(!$('#consent').checked){ const box=$('#eligError'); box.textContent = 'Para continuar, aceite as Condi√ß√µes Gerais e o uso de dados (LGPD).'; box.classList.remove('hide'); return; }
      $('#eligError').classList.add('hide');

      // console.log(idsegurado)
      // const payload = {
      //   //cpf: $('#cpf_hidden').value,
      //   idsegurado: idsegurado,
      //   nome: $('#nome').value,
      //   nascimento: $('#nascimento').value,
      //   rg: $('#rg').value,
      //   telefone: $('#telefone').value,
      //   endereco: $('#endereco').value,
      //   profissao: $('#profissao').value,
      //   renda: $('#renda').value,
      //   grupo: $('#grupo').value,
      //   cota: $('#cota').value,
      //   prazo_meses: $('#prazo').value,
      //   pep: $('#pep').value,
      //   //optin: true,
      //   //utm_source: $('#utm_source').value,
      //   //utm_medium: $('#utm_medium').value,
      //   //utm_campaign: $('#utm_campaign').value
      // };
            

            let confirmacaodecompra = document.getElementById("venda").value
            console.log(confirmacaodecompra)
            let dataDeEnvio = getFormattedDate()
            const novotelefone = document.getElementById("telefone").value
            const ddd = novotelefone.slice(0, 2)
            const telefoneSemDDD = novotelefone.slice(2)
            
            
            novotelefone
            console.log(novotelefone)


            const payload = {


        idsegurado: idsegurado,
        // idsegurado: 1529195,
        dados: [{
          magalu_resposta_nome: $('#nome').value,
          magalu_resposta_nascimento: $('#nascimento').value,
          magalu_resposta_rg: $('#rg').value,
          magalu_resposta_telefone: telefoneSemDDD,
          magalu_resposta_ddd: ddd,
          magalu_resposta_endereco: $('#endereco').value,
          magalu_resposta_cidade: $('#cidade').value,
          magalu_resposta_bairro: $('#bairro').value,
          magalu_resposta_uf: $('#uf').value,
          magalu_resposta_cep: $('#cep').value,
          magalu_resposta_profissao: $('#profissao').value,
          magalu_resposta_renda: $('#renda').value,
          magalu_resposta_grupo: $('#grupo').value,
          magalu_resposta_cota: $('#cota').value,
          magalu_resposta_optin: true,
          // magalu_resposta_prazo_meses: $('#prazo').value,
          magalu_resposta_pep: $('#pep').value,
          magalu_resposta_data: dataDeEnvio,
          magalu_resposta_premio_de_seguro: window.valor_mes,
          magalu_resposta_taxa: window.taxa,
          magalu_resposta_valor_credito: window.valorcredito,
          magalu_resposta_cpf: cpf2,
          magalu_resposta_conf: confirmacaodecompra
        }]
      };


      
      try {
        // let token2 = "TWFnYWx1Okd2OUByTCF4RnoyI0twOHFOdCQxVXc2ZQ=="

        document.getElementById('btnOptIn').disabled = true; 

        const username = "Magalu";
        const password = "Gv9@rL!xFz2#Kp8qNt$1Uw6e";

        const credentials = btoa(`${username}:${password}`);

        let token = data()
        //const r = await fetch('https://devwebhook.keepins.app/webhook/formulario/wiz', {method:'POST',  headers: {"Content-Type": "application/json",    "Authorization": `${token}`}, body: JSON.stringify(payload)});
        // const r = await fetch('https://hmln8n.keepins.app/webhook/formulario/magalu', {method:'POST',  headers: {"Content-Type": "application/json",    "Authorization": `${token}`}, body: JSON.stringify(payload)});
        // const r = await fetch('https://hmlwebhook.keepins.app/webhook/formulario/magalu', {method:'POST',  headers: {"Content-Type": "application/json",    "token": `${token}`, "Authorization": `${token2}` }, body: JSON.stringify(payload)});
         const r = await fetch('https://hmln8n.keepins.app/webhook/formulario/magalu', {method:'POST',  headers: {"Content-Type": "application/json", "Authorization": `Basic ${credentials}`, "token": `${token}`},body: JSON.stringify(payload)});


        if(!r.ok) throw new Error('Falha ao enviar');
      } catch(err){ const box=$('#eligError'); box.textContent = 'N√£o foi poss√≠vel concluir agora. Tente novamente.'; box.classList.remove('hide'); return; }
      finally {
        document.getElementById('btnOptIn').disabled = false;
      }


      hide($('#form-adesao'));
      $('#okMsg').textContent = 'Obrigado! Enviamos a confirma√ß√£o e pr√≥ximas etapas para seu e‚Äëmail.';
      show($('#step-ok'));
      stepActive(3);
      dataLayer.push({event:'optin_enviado'});
    });

    // Opt‚Äëout
    // $('#btnOptOut').addEventListener('click', async () => {
    //   try{ await fetch('/api/optout', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({cpf: $('#cpf_hidden').value || $('#cpf').value.replace(/\D/g,'')})}); }catch(e){}
    //   hide($('#form-adesao'));
    //   $('#okMsg').textContent = 'Registro realizado. Voc√™ n√£o receber√° mais ofertas desta campanha.';
    //   show($('#step-ok'));
    //   stepActive(3);
    //   dataLayer.push({event:'optout_enviado'});
    // });
  </script>
</body>
</html>